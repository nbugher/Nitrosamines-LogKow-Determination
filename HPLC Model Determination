import os
import pandas as pd
import seaborn as sns
import matplotlib.pyplot as plt
import numpy as np

#Read File
#os.chdir('/Users/nbugher/MIT Dropbox/Nicolette Bugher/Plata Lab/Bugher/SRP/Chapter 4 (K estimation)')
#mdf3 = pd.ExcelFile("Your Data File")

nitrosamines = pd.read_excel(mdf3, 'Nitrosamine k')
references = pd.read_excel(mdf3, 'Reference k')
formamides = pd.read_excel(mdf3, 'formamide k')
retention_times = pd.read_excel(mdf3, 'Retention time')

mdf7 = pd.ExcelFile('/Users/nbugher/MIT Dropbox/Nicolette Bugher/Plata Lab/Bugher/SRP/Chapter 4 (K estimation)/logkw_regression_lines_for_python.xlsx')
ref_regressions = pd.read_excel(mdf7, 'references')
nam_regressions = pd.read_excel(mdf7,'nitrosamines')


#%%take log K of all reference compounds, nitrosamines, formamides


references_log_k = references.copy()
references_log_k.iloc[:, 1:] = np.log10(references_log_k.iloc[:, 1:])

nitrosamines_log_k = nitrosamines.copy()
nitrosamines_log_k.iloc[:, 1:] = np.log10(nitrosamines_log_k.iloc[:, 1:])

formamides_log_k = formamides.copy()
formamides_log_k.iloc[:, 1:] = np.log10(formamides_log_k.iloc[:, 1:])

#%% prepare regression lines to overlay raw data

x = np.linspace(0, 0.8, 100)


    




#%% Plot log k for reference compounds
# Assuming 'references_log_k' is your dataframe for the Reference k sheet
# Melt the dataframe to long format for seaborn
references_log_k_long = references_log_k.melt(id_vars='phi', var_name='compound', value_name='log_k')


sns.set(rc = {'figure.figsize':(7,3.33),
    'xtick.bottom': True,
    'ytick.left': True,}, font_scale = 1.2, style = 'white')
figure, ax = plt.subplots(1,1)

palette = sns.color_palette('colorblind')

sns.scatterplot(data=references_log_k_long, x='phi', y='log_k', hue='compound', marker='o', palette = palette)
for index, row in ref_regressions.iterrows():
    y = row['Slope'] * x + row['Intercept']
    plt.plot(x, y, color = palette[index], ls=':' ,alpha = 0.8, zorder = 0)


plt.xlabel('φ')
plt.ylabel(r'$log k^{\prime}$')
plt.legend(fontsize = 8, reverse = True)
plt.tight_layout()

plt.ylim(-1,2)
plt.xlim(-0.01,0.85)


#save figure
#plt.savefig('REGRESSIONS_final_logk_references_screen.pdf', format='pdf', bbox_inches='tight')


plt.show()

#%% Plot log k for nitrosamines

sns.set(rc = {'figure.figsize':(7,3.33),
    'xtick.bottom': True,
    'ytick.left': True,}, font_scale = 1.2, style = 'white')

figure, ax = plt.subplots(1,1)

nitrosamines_log_k_long = nitrosamines_log_k.melt(id_vars='phi', var_name='compound', value_name='log_k')


sns.scatterplot(data=nitrosamines_log_k_long, x='phi', y='log_k', hue='compound', marker='s', palette = palette)

for index, row in nam_regressions.iterrows():
    y = row['Slope'] * x + row['Intercept']
    plt.plot(x, y, color = palette[index], ls=':' ,alpha = 0.8, zorder = 0)


#plt.title('Nitrosamines')
plt.xlabel('φ')
plt.ylabel(r'$log k^{\prime}$')
plt.legend(fontsize = 8, reverse = True)
plt.ylim(-1,2)
plt.xlim(-0.01,0.85)


plt.tight_layout()
#plt.savefig('REGRESSIONS_final_logk_nitrosamines_no_screen.pdf', format='pdf', bbox_inches='tight')
plt.show()

#%% plot log k for formamides

sns.set(rc = {'figure.figsize':(7,4),
    'xtick.bottom': True,
    'ytick.left': True,}, font_scale = 1.2, style = 'white')

figure, ax = plt.subplots(1,1)

formamides_log_k_long = formamides_log_k.melt(id_vars='phi', var_name='compound', value_name='log_k')


sns.lineplot(data=formamides_log_k_long, x='phi', y='log_k', hue='compound', marker='X', palette = palette)
plt.title('Formamides log k vs φ')
plt.xlabel('φ')
plt.ylabel('log k')
plt.legend(title='Compound')

handles, labels = ax.get_legend_handles_labels()
ax.legend(handles[::-1], labels[::-1], title='Compound')


plt.tight_layout()
#plt.savefig('logk_formamides_no_screen.pdf', format='pdf', bbox_inches='tight')
plt.show()





#%% Divide the plots to get kw using high and low values of phi depending on hydrophobicity of potential compounds and references


mdf4 = pd.ExcelFile("/Users/nbugher/MIT Dropbox/Nicolette Bugher/Plata Lab/Bugher/SRP/Chapter 4 (K estimation)/HPLC_LogK_Python_Data_Screened.xlsx")
nitrosamines_high = pd.read_excel(mdf4, 'Nitrosamine k high')
nitrosamines_low = pd.read_excel(mdf4, 'Nitrosamine k low')
references_high = pd.read_excel(mdf4, 'Reference k high')
references_low = pd.read_excel(mdf4, 'Reference k low')
formamides_high = pd.read_excel(mdf4, 'formamide k high')
formamides_low = pd.read_excel(mdf4, 'formamide k low')

#%% get log k of each set

references_log_k_high = references_high.copy()
references_log_k_high.iloc[:, 1:] = np.log10(references_log_k_high.iloc[:, 1:])

references_log_k_low = references_low.copy()
references_log_k_low.iloc[:, 1:] = np.log10(references_log_k_low.iloc[:, 1:])

nitrosamines_log_k_high = nitrosamines_high.copy()
nitrosamines_log_k_high.iloc[:, 1:] = np.log10(nitrosamines_log_k_high.iloc[:, 1:])

nitrosamines_log_k_low = nitrosamines_low.copy()
nitrosamines_log_k_low.iloc[:, 1:] = np.log10(nitrosamines_log_k_low.iloc[:, 1:])

formamides_log_k_high = formamides_high.copy()
formamides_log_k_high.iloc[:, 1:] = np.log10(formamides_log_k_high.iloc[:, 1:])

formamides_log_k_low = formamides_low.copy()
formamides_log_k_low.iloc[:, 1:] = np.log10(formamides_log_k_low.iloc[:, 1:])

#%% plot references high and low

##### HIGH ####


references_log_k_long_h = references_log_k_high.melt(id_vars='phi', var_name='compound', value_name='log_k')


sns.set(rc = {'figure.figsize':(7,4),
    'xtick.bottom': True,
    'ytick.left': True,}, font_scale = 1.2, style = 'white')
figure, ax = plt.subplots(1,1)

palette = sns.color_palette('colorblind')

sns.lineplot(data=references_log_k_long_h, x='phi', y='log_k', hue='compound', marker='o', palette = palette)
plt.title('Reference Compound log k vs φ')
plt.xlabel('φ')
plt.ylabel('log k')
plt.legend(title='Compound')
ax.set_xlim(0, 1)
plt.tight_layout()

handles, labels = ax.get_legend_handles_labels()
ax.legend(handles[::-1], labels[::-1], title='Compound')

#save figure
#plt.savefig('logk_references_screen_high.pdf', format='pdf', bbox_inches='tight')


plt.show()

#%% References LOW SCREENED
##### LOW #######

references_log_k_long_l = references_log_k_low.melt(id_vars='phi', var_name='compound', value_name='log_k')


sns.set(rc = {'figure.figsize':(7,4),
    'xtick.bottom': True,
    'ytick.left': True,}, font_scale = 1.2, style = 'white')
figure, ax = plt.subplots(1,1)

palette = sns.color_palette('colorblind')

sns.lineplot(data=references_log_k_long_l, x='phi', y='log_k', hue='compound', marker='o', palette = palette)
plt.title('Reference Compound log k vs φ')
plt.xlabel('φ')
plt.ylabel('log k')
plt.legend(title='Compound')
ax.set_xlim(0, 1)
plt.tight_layout()

handles, labels = ax.get_legend_handles_labels()
ax.legend(handles[::-1], labels[::-1], title='Compound')

#save figure
#plt.savefig('logk_references_screen_low.pdf', format='pdf', bbox_inches='tight')


plt.show()


#%% plot nitrosamines high and low


###### HIGH #######

sns.set(rc = {'figure.figsize':(7,4),
    'xtick.bottom': True,
    'ytick.left': True,}, font_scale = 1.2, style = 'white')

figure, ax = plt.subplots(1,1)

nitrosamines_log_k_long_h = nitrosamines_log_k_high.melt(id_vars='phi', var_name='compound', value_name='log_k')



sns.lineplot(data=nitrosamines_log_k_long_h, x='phi', y='log_k', hue='compound', marker='X', palette = palette)
plt.title('Nitrosamine log k vs φ')
plt.xlabel('φ')
plt.ylabel('log k')
ax.set_xlim(0, 1)
plt.legend(title='Compound')

handles, labels = ax.get_legend_handles_labels()
ax.legend(handles[::-1], labels[::-1], title='Compound')

plt.tight_layout()
#plt.savefig('logk_nitrosamines_screen_high.pdf', format='pdf', bbox_inches='tight')
plt.show()

#%% nitrosamines LOW SCREENED

####### LOW #######

sns.set(rc = {'figure.figsize':(7,4),
    'xtick.bottom': True,
    'ytick.left': True,}, font_scale = 1.2, style = 'white')

figure, ax = plt.subplots(1,1)

nitrosamines_log_k_long_l = nitrosamines_log_k_low.melt(id_vars='phi', var_name='compound', value_name='log_k')



sns.lineplot(data=nitrosamines_log_k_long_l, x='phi', y='log_k', hue='compound', marker='X', palette = palette)
plt.title('Nitrosamine log k vs φ')
plt.xlabel('φ')
plt.ylabel('log k')
ax.set_xlim(0, 1)
plt.legend(title='Compound')

handles, labels = ax.get_legend_handles_labels()
ax.legend(handles[::-1], labels[::-1], title='Compound')

plt.tight_layout()
#plt.savefig('logk_nitrosamines_screen_low.pdf', format='pdf', bbox_inches='tight')
plt.show()

#%% Formamides screend high and low 

##### HIGH#######


sns.set(rc = {'figure.figsize':(7,4),
    'xtick.bottom': True,
    'ytick.left': True,}, font_scale = 1.2, style = 'white')

figure, ax = plt.subplots(1,1)

formamides_log_k_long_h = formamides_log_k_high.melt(id_vars='phi', var_name='compound', value_name='log_k')



sns.lineplot(data=formamides_log_k_long_h, x='phi', y='log_k', hue='compound', marker='X', palette = palette)
plt.title('Formamides log k vs φ')
plt.xlabel('φ')
plt.ylabel('log k')
ax.set_xlim(0, 1)
plt.legend(title='Compound')

handles, labels = ax.get_legend_handles_labels()
ax.legend(handles[::-1], labels[::-1], title='Compound')


plt.tight_layout()
#plt.savefig('logk_formamides_screen_high.pdf', format='pdf', bbox_inches='tight')
plt.show()


#%% formamides low screend 

##### LOW #####

sns.set(rc = {'figure.figsize':(7,4),
    'xtick.bottom': True,
    'ytick.left': True,}, font_scale = 1.2, style = 'white')

figure, ax = plt.subplots(1,1)

formamides_log_k_long_l = formamides_log_k_low.melt(id_vars='phi', var_name='compound', value_name='log_k')



sns.lineplot(data=formamides_log_k_long_l, x='phi', y='log_k', hue='compound', marker='X', palette = palette)
plt.title('Formamides log k vs φ')
plt.xlabel('φ')
plt.ylabel('log k')
ax.set_xlim(0, 1)
plt.legend(title='Compound')

handles, labels = ax.get_legend_handles_labels()
ax.legend(handles[::-1], labels[::-1], title='Compound')


plt.tight_layout()
#plt.savefig('logk_formamides_screened_low.pdf', format='pdf', bbox_inches='tight')
plt.show()




